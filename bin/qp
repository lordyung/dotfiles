#!/bin/bash

# qshell fput <Bucket> <Key> <LocalFile>

Bucket=distfiles
if [ $#  = 1  ]; then
    LocalFile=$1
    Key=$1
elif [ $#  = 2  ]; then
    LocalFile=$1
    Prefix=$2
    Key=$Prefix/$1
else
    echo Usuage: qp [Key] \(Prefix\)
    exit
fi

url=http://ot2jmekaj.bkt.clouddn.com/`qshell urlencode $Key`

# 测试是否存在此文件
wget -T 15 --tries=1 --spider $url > /dev/null 2>&1
[ $? -eq 0 ] && echo $url && hash pbcopy > /dev/null 2>&1  && echo -n $url | pbcopy  && exit  # 将内容复制到Mac剪贴板

# 将文件推送到Bucket
qshell fput $Bucket $Key $LocalFile
[ $? -eq 0 ] && echo $url && hash pbcopy > /dev/null 2>&1  && echo -n $url | pbcopy  && exit  # 将内容复制到Mac剪贴板
